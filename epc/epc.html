<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vehicle EPC</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3C!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--%3E%3Cpath fill='%23fff' opacity='1' d='M430.5 284.4l-31.82-79.54C383.7 177.6 357.7 160 328.4 160H183.6C154.3 160 128.3 177.6 117.4 204.8l-31.82 79.56C62.88 301.1 48 329.2 48 360V480c0 17.67 14.33 32 32 32H96c17.67 0 32-14.33 32-32v-32h288v32c0 17.67 14.33 32 32 32s32-14.33 32-32v-120C464 329.2 449.1 301.1 426.4 284.4zM161.9 222.7C165.5 213.8 174 208 183.6 208h144.8c9.598 0 18.1 5.76 21.66 14.66L366.6 264H145.4L161.9 222.7zM416 400H96v-40c0-26.47 21.53-48 48-48h224c26.47 0 48 21.53 48 48V400zM505.9 111.1H447.8l-21.37-31.1l21.37-31.1h58.14c4.619 0 7.619-5.048 5.246-9.001C497.2 15.66 471.7 0 442.4 0c-32.79 0-60.59 19.86-73.01 48H142.8C131.9 23.19 108.6 4.574 80.9 .7793c-33.87-4.641-64.28 11.89-80.05 38.19c-2.381 3.955 .6094 9.034 5.24 9.034H64.22l21.37 31.1L64.22 112H6.078c-4.619 0-7.619 5.047-5.246 9.002C14.82 144.3 40.33 160 69.57 160c32.79 0 60.59-19.86 73.01-47.1h226.6c10.97 24.81 34.23 43.43 61.94 47.22c33.87 4.641 64.28-11.89 80.05-38.19C513.5 117.1 510.5 111.1 505.9 111.1zM160 336c-13.25 0-24 10.74-24 24C136 373.3 146.7 384 160 384s24-10.75 24-24C184 346.7 173.3 336 160 336zM352 336c-13.25 0-24 10.74-24 24c0 13.25 10.75 24 24 24s24-10.75 24-24C376 346.7 365.3 336 352 336z'/%3E%3Cpath fill='white' opacity='0.4' d='M511.2 121c-15.77 26.3-46.18 42.83-80.05 38.19c-27.7-3.795-50.96-22.41-61.94-47.22H142.6C130.2 140.1 102.4 160 69.57 160C40.33 160 14.82 144.3 .832 121C-1.541 117 1.459 112 6.078 112H64.22l21.37-31.1L64.22 48H6.09c-4.631 0-7.621-5.068-5.24-9.034c15.77-26.3 46.18-42.83 80.05-38.19c27.7 3.795 50.96 22.41 61.94 47.22h226.6C381.8 19.86 409.6 0 442.4 0c29.23 0 54.75 15.66 68.73 38.1c2.373 3.955-.627 9.001-5.246 9.001H447.8l-21.37 31.1l21.37 31.1h58.13C510.5 111.1 513.5 117.1 511.2 121z'/%3E%3C/svg%3E">
  
  <!-- START: CORRECTED AND UNIFIED STYLESHEET -->
  <style>
    /* This stylesheet is now based on diagram.html and includes all necessary styles */
    html, body {
      height: 100%;
      width: 100vw;
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #f4f4f9;
      transition: background-color 0.3s;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      box-sizing: border-box; /* Ensures padding is included in total width/height */
    }

    /* --- 1. UNIFIED HEADER STYLES (from diagram.html) --- */
    .epc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      flex-shrink: 0;
      box-sizing: border-box;
    }
    .epc-header-left {
      display: flex;
      align-items: center;
      gap: 0.9rem;
    }
    .epc-header h1 {
      font-size: 1.6rem;
      font-weight: 700;
      color: #121212;
      margin: 0;
    }
    .epc-header-actions {
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }
    .epc-header-home {
      display: inline-block;
      padding: 0.6rem 1.4rem;
      font-size: 1.14rem;
      font-weight: 600;
      color: #6c757d;
      border: 1.5px solid #dee2e6;
      border-radius: 8px;
      text-decoration: none;
      transition: background 0.18s, color 0.18s, border 0.18s;
      letter-spacing: 0.01em;
    }
    .epc-header-home:hover {
      color: #007bff;
      border-color: #007bff;
    }
    .epc-theme-toggle {
        background: #fff;
        border: 1.5px solid #dee2e6;
        border-radius: 50%;
        cursor: pointer;
        width: 44px; height: 44px;
        display: flex; justify-content: center; align-items: center;
        color: #6c757d;
        font-size: 1.2rem;
        transition: background-color 0.3s, border-color 0.3s;
    }

    /* --- 2. UNIFIED BREADCRUMB STYLES --- */
    .breadcrumb {
      display: flex; flex-wrap: wrap;
      padding: 0.5rem 1rem;
      list-style: none;
      background-color: #e9ecef;
      border-radius: 0.25rem;
      font-size: 0.9rem;
      color: #003366;
      margin: 0 1.5rem 1rem 1.5rem; /* Match header padding */
    }
    .breadcrumb-item + .breadcrumb-item::before {
      content: "›"; padding: 0 0.5rem; color: #6c757d;
      user-select: none; font-weight: 700; font-size: 1rem;
    }
    .breadcrumb-item a { color: #003366; text-decoration: none; cursor: pointer; }
    .breadcrumb-item a:hover { text-decoration: underline; }
    .breadcrumb-item.active { color: #555; font-weight: 600; }
    
    /* --- 3. EPC.HTML THREE-COLUMN LAYOUT STYLES --- */
    .container { 
      display: flex; 
      gap: 1rem; /* Reduced gap for better fit */
      flex-wrap: wrap;
      padding: 0 1.5rem 1.5rem 1.5rem; /* Match header padding */
      flex-grow: 1;
      min-height: 0;
    }
    .list-container { 
      background: #fff; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
      border-radius: 8px; 
      padding: 1rem; 
      flex: 1 1 300px; 
      overflow-y: auto; 
      border: 1px solid #dee2e6; 
      display: flex;
      flex-direction: column;
    }
    .list-container h2 { 
      margin-top: 0; margin-bottom: 1rem; 
      font-size: 1.2rem; 
      color: #121212; 
      border-bottom: 2px solid #003366; 
      padding-bottom: 0.3rem; 
      flex-shrink: 0;
    }
    .list-container ul { list-style: none; padding: 0; margin: 0; }
    .list-container ul li { 
      padding: 0.5rem 0.75rem; 
      border-bottom: 1px solid #dee2e6; 
      cursor: pointer; border-radius: 4px; 
      transition: background-color 0.2s, color 0.2s; 
      color: #003366; 
      background: none; 
    }
    .list-container ul li:hover { background-color: #e0f0ff; }
    .list-container ul li.selected { background-color: #c0dafd !important; font-weight: bold; color: #003366; }

    /* --- 4. DARK THEME STYLES --- */
    body[data-bs-theme="dark"] { background: #212529; color: #e1e9f7; }
    body[data-bs-theme="dark"] .epc-header h1 { color: #dee2e6; }
    body[data-bs-theme="dark"] .epc-header-home, 
    body[data-bs-theme="dark"] .epc-theme-toggle { border-color: #6c757d; color: #adb5bd; }
    body[data-bs-theme="dark"] .epc-theme-toggle { background: #181818; }
    body[data-bs-theme="dark"] .breadcrumb { background: #495057; color:#c7d7ef; }
    body[data-bs-theme="dark"] .breadcrumb-item a { color: #c7d7ef; }
    body[data-bs-theme="dark"] .breadcrumb-item.active { color: #fff; }
    body[data-bs-theme="dark"] .list-container { background: #181818; border-color: #495057; }
    body[data-bs-theme="dark"] .list-container h2 { color: #eaf1ff; border-bottom-color: #ccc; }
    body[data-bs-theme="dark"] .list-container ul li { border-bottom-color: #495057; color: #eaf1ff; }
    body[data-bs-theme="dark"] .list-container ul li:hover { background-color: #25344a; }
    body[data-bs-theme="dark"] .list-container ul li.selected { background-color: #38507c !important; color: #eaf1ff; }
    body[data-bs-theme="dark"] [data-invert-in-dark="true"] { filter: invert(1) brightness(1.08); }

    /* --- 5. SCROLLBARS AND MEDIA QUERIES --- */
    body[data-bs-theme="dark"]::-webkit-scrollbar { width: 12px; background: #23272e; }
    body[data-bs-theme="dark"]::-webkit-scrollbar-thumb { background: #3d434e; border-radius: 8px; border: 2px solid #23272e; }
    body[data-bs-theme="dark"]::-webkit-scrollbar-thumb:hover { background: #596080; }
    body[data-bs-theme="dark"] { scrollbar-color: #3d434e #23272e; scrollbar-width: thin; }

    @media (max-width: 700px) {
      .epc-header, .breadcrumb, .container { padding-left: 0.5rem; padding-right: 0.5rem; }
      .container { flex-direction: column; gap: 0.8rem; }
    }
  </style>
  <!-- END: CORRECTED AND UNIFIED STYLESHEET -->
</head>
<body data-bs-theme="dark">
    
    <!-- START: UNIFIED HEADER HTML -->
    <div class="epc-header">
        <div class="epc-header-left">
            <img id="model-logo" style="height: 50px; display: none;" alt="Model Logo">
            <h1>Electronic Parts Catalogue</h1>
        </div>
        <div class="epc-header-actions">
            <a href="#" id="epc-home-btn" class="epc-header-home">‹ Home</a>
            <button id="theme-toggle" class="epc-theme-toggle" title="Toggle light/dark mode">
                <span class="moon-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:20px;height:20px;fill:currentColor;"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41zm12.72 12.72c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41zM5.64 18.36c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41zM18.36 5.64c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41z"/></svg>
                </span>
                <span class="sun-icon" style="display:none;">


                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:20px;height:20px;fill:currentColor;"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>



                </span>
            </button>
        </div>
    </div>
    <!-- END: UNIFIED HEADER HTML -->

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb" id="epc-breadcrumb"></ol>
    </nav>

    <div id="error-message" style="display:none;"></div>
    <div class="container" id="main-content" style="display:none;">
      <div class="list-container" style="flex-basis: 25%;"><h2>Sections</h2><ul id="sections-list"></ul></div>
      <div class="list-container" style="flex-basis: 25%;"><h2>Sub Sections</h2><ul id="subsections-list"></ul></div>
      <div class="list-container" style="flex-basis: 50%;"><h2>Details</h2><ul id="details-list"></ul></div>
    </div>

    <!-- START: UNIFIED SCRIPT -->
    <script type="module">
      // --- UNIVERSAL HELPER FUNCTIONS ---
      function isElectron() { return navigator.userAgent.toLowerCase().indexOf(' electron/') > -1; }
      function getRootPath() { 
        if (window.location.pathname.includes('/epc/')) { return '../'; } 
        return './'; 
      }

      // --- UNIVERSAL THEME LOGIC ---
      function setTheme(theme) {
        document.body.setAttribute('data-bs-theme', theme);
        localStorage.setItem('theme', theme);
        updateThemeIcon();
      }
      function updateThemeIcon() {
        document.querySelectorAll('#theme-toggle').forEach(btn => {
          const moon = btn.querySelector('.moon-icon');
          const sun = btn.querySelector('.sun-icon');
          if (!moon || !sun) return;
          if (document.body.getAttribute('data-bs-theme') === 'dark') {
            sun.style.display = 'none';
            moon.style.display = '';
          } else {
            sun.style.display = '';
            moon.style.display = 'none';
          }
        });
      }

      // --- PAGE-SPECIFIC LOGIC ---
      import { initEPCApp } from './js/epcApp.js';

      function initializeEpcDetailPage() {
        const urlParams = new URLSearchParams(window.location.search);
        const brandCode = (urlParams.get('brand') || '').toLowerCase();
        const modelCode = (urlParams.get('model') || '').toLowerCase();
        const logoImg = document.getElementById('model-logo');
        const rootPath = getRootPath();

        if (brandCode) {
          fetch(`${rootPath}data/brands.json`)
            .then(res => res.json())
            .then(brands => {
              const brandData = brands.find(b => b.code.toLowerCase() === brandCode);
              if (brandData && logoImg) {
                  logoImg.src = brandData.logo;
                  logoImg.style.display = 'block';
                  logoImg.alt = brandData.name + " Logo";
                  if (brandData.invertInDark) {
                      logoImg.setAttribute('data-invert-in-dark', 'true');
                  }
              }
            });
        }
        
        initEPCApp({
          brandCode, modelCode, rootPath,
          breadcrumbEl: document.getElementById('epc-breadcrumb'),
          sectionsListEl: document.getElementById('sections-list'),
          subsectionsListEl: document.getElementById('subsections-list'),
          detailsListEl: document.getElementById('details-list'),
          errorMessageEl: document.getElementById('error-message'),
          mainContentEl: document.getElementById('main-content'),
        });
      }

      // --- UNIVERSAL MASTER EVENT LISTENER ---
      document.body.addEventListener('click', function(e) {
        const homeLink = e.target.closest('.epc-header-home');
        const themeToggleButton = e.target.closest('#theme-toggle');

        if (homeLink) {
          e.preventDefault();
          const root = getRootPath();
          if (isElectron()) { window.location.href = root + 'app-home.html'; } 
          else { window.location.href = root + 'index.html'; }
        }
        
        if (themeToggleButton) {
          const current = document.body.getAttribute('data-bs-theme');
          setTheme(current === 'dark' ? 'light' : 'dark');
        }
      });
      
      // --- UNIVERSAL PAGE INITIALIZATION ---
      setTheme(localStorage.getItem('theme') || 'dark');
      initializeEpcDetailPage();
    </script>
    <!-- END: UNIFIED SCRIPT -->

</body>
</html>